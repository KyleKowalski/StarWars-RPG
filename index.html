<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">

  <title>Hangman</title>

  	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  	<!-- <script src="https://code.jquery.com/jquery.js"></script> -->
  	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<link rel="stylesheet" type="text/css" href="assets\css\stylePostBootstrap.css">

</head>
<body>
	<container class="text-center">
		<row>
			<div id="title" class="">
				<h1>Star Wars</h1>
				<h3>Role Playing Game</h3>
				<h4>by Kyle Kowalski</h4>
			</div>
				<hr>
			<div id="rules" class="">
				<h5>Gameplay:</h5>
				<h5>Select a character to represent you.</h5>
				<h5>Then select your first opponent.</h5>
				<h5>Once both are selected click 'Attack' until you either defeat said opponent or lose.</h5>
				<h5>Select another opponent and continue with attacks, repeat until you either win or lose.</h5>
				<h5>To win, you must defeat all opponents!</h5>
				<hr>
				<h5>You might notice as you fight opponents your character will grow in strength, this should make future fights significantly easier.</h5>
			</div>
		</row>
	</container>
	<container id="initialSelection" class="">
			<row>
				<h1>Please select your initial combatant from the choices below:</h1>
			</row>
			<row>
				<div id="allCharactersHere"></div>
			</row>
	</container>
	<container id="combatContainer" class="hidden float-left">
		<row class="col-md-12">
			<div class="col-md-5">
				<h3>Player Choice:</h3>
				<div id="playerCharacterHere"></div>
			</div>
			<div class="col-md-2">
				<div class="btn btn-warning align-middle" id="attackButton">Attack</div>
			</div>
			<div class="col-md-5">
				<h3>Opponent:</h3>
				<div id="selectOpponent">Please select an opponent</div>
				<div id="opponentCharacterHere"></div>
			</div>
		</row>
		<row class="col-md-12">
			<div class="col-md-6">
				<h3>Pool:</h3>
				<div id="aliveCharactersHere"></div>
			</div>
			<div class="col-md-6">
				<h3>Defeated:</h3>
				<div id="defeatedCharactersHere"></div>
			</div>
		</row>
	</container>
	<container id="winLossContainer" class="hidden absolute text-center">
		<row>
			<div>
				<h1 id="winOrLoss"></h1>
				<hr>
				<h3>Click in this window to reset the game!</h3>
			</div>
		</row>
	</container>

	<script type="text/javascript">

     	// $(document).ready(function() {

      // 	});

  		// obvious variable is obvious - used for 'teaching' myself and others.
  		var debugging = false;
  		var verbose = false;

  		if (debugging) {console.log("----- Start Game -----");}

  		// show 4 possible players on screen
  		// Player Health, AttackPower, CounterAttackPower



  		var player = {
  			Choice:"",
  			Opponent:""
  		}

  		var gameCharacters = initialSetup();

  		$(document).on('click', function(event) {
    		console.log(event.target.id);

    		if (event.target.id != null && event.target.id != "") {
    			// make sure we're only allowing id's that are valid for game use (ie dropping the 'title' div and what not)
    			if (isValidClick(event.target.id)) {
    				console.log("User selection: " + event.target.id);
		    		// initial player selection
		    		if (player.Choice == "") {
		    			player.Choice = event.target.id;
		    			console.log("Selecting player: " + player.Choice);
			    		gameCharacters[player.Choice].Status = "player";
			    		$("#initialSelection").addClass("hidden");
			    		characterDivSetup();
			    		$("#combatContainer").removeClass("hidden");
		    		}
		    		// assigning opponent selection
		    		else if (player.Opponent == "") {
		    			player.Opponent = event.target.id;
		    			console.log("Selecting opponent: " + player.Opponent);
		    			gameCharacters[player.Opponent].Status = "opponent";
		    			$("#selectOpponent").addClass("hidden");
		    			characterDivSetup();
		    		}
		    		else if (player.Choice != "" && player.Opponent != "") {
		    			console.log("Received click for: " + event.target.id + " but combat is not yet resolved.  Ignoring the click." );
		    		}
		    		else {
		    			console.log("We have a problem with the on click events");
		    		}

    			}
    			else if (event.target.id == "attackButton" && player.Opponent != "") {
    				chooseOpponentAndFight(player.Opponent);
    			}
    			else {
    				console.log("looks like player is clicking attack without opponent - or we have something else wrong, dropping the click.")
    			}
    		}
		});
  		//player click make this better
  		//player.Choice = "Luke";
  		//console.log("Player chose: " +  player.Choice);
  		//gameCharacters.Luke.Status = "player"; // allows us to choice for 'player' stats later (I hope?)

  		// click button to choose my player
  			// Luke
  			// Obi-Wan
  			// Darth Sideous
  			// Darth Maul
  			// TODO Add in:  Darth Vader / General Grievous / Yoda / Han + Chewie
  			// TODO - make it choose 4x of these?  Or any/all?  Unlock toons?

  		// other players become opponents - all three

		// when opponent HP drops to zero - opponent is defeated

		// player chooses next opponent (of remaining 2)

		// when oppoent HP drops to zero - oppoentn is defeated

		// player automagically fights last opponent

		// if player defeats everyone - player wins!

		// if players HP drops below 0... player loses

		// no health potions.  

		function chooseOpponentAndFight(Opponent) {
  			console.log("----- Battle Started -----");
	  		// player chooses one opponent
	  		player.Opponent = Opponent;
	  		gameCharacters[player.Opponent].Status = "opponent";
	  		console.log("Player using: " + player.Choice);
	  		console.log("Currently facing off against: " + player.Opponent);
	  		console.log("Current HP: " + gameCharacters[player.Choice].HP);
	  		console.log("Current AP Growth: " + gameCharacters[player.Choice].APGrowth);
	  		console.log("Player Current AP: " + gameCharacters[player.Choice].AP);
	  		console.log("Opponent HP: " + gameCharacters[player.Opponent].HP);
	  		console.log("Opponent Counter AP: " + gameCharacters[player.Opponent].CounterAP);
			
			// click 'attack' - this attacks the target and increases base attack based on attack (attack = attack + basePower... goes up forever)
			// this also removes HP based on targets counterattack power
			
			// TODO write this to a text box for dramatic effect?
			if ((gameCharacters[player.Opponent].HP > 0) && (gameCharacters[player.Choice].HP > 0)) {
				// player attacks
				gameCharacters[player.Opponent].HP -= gameCharacters[player.Choice].AP;
				console.log("Player damages opponent - their HP remaining: " + gameCharacters[player.Opponent].HP);

				// player attack grows!
				gameCharacters[player.Choice].AP += gameCharacters[player.Choice].APGrowth;
				console.log("Player learns to attack better! New AP: " + gameCharacters[player.Choice].AP);

				// not damaged by counter if opponent defeated - we'll call this a house rule.  It makes the game SIGNIFICANTLY easier.  
				if (gameCharacters[player.Opponent].HP > 0) {
					// opponent counters
					gameCharacters[player.Choice].HP -= gameCharacters[player.Opponent].CounterAP;
					console.log("Opponent counters, new HP: " + gameCharacters[player.Choice].HP);
				}
			}

			if (gameCharacters[player.Opponent].HP <= 0) {
				console.log("Opponent " + player.Opponent + " defeated!");
				gameCharacters[player.Opponent].Status = "defeated";
				player.Opponent = "";
				$("#selectOpponent").removeClass("hidden");
			}
			else if (gameCharacters[player.Choice].HP <= 0) {
				console.log("Player is defeated!");
				//alert("game over, player died!");
				$("#winLossContainer").removeClass("hidden");
				$("#winOrLoss").html("You lost!");
			}
			else {
				console.log("Looks like both Opponent and player are alive.  Player HP: " + gameCharacters[player.Choice].HP + " Opponent HP: " + gameCharacters[player.Opponent].HP);
			}
			console.log("----- Battle Ended -----");
			characterDivSetup();
		};

	  	function characterDivSetup() {
	  		// cleanup and splat things in again - is this the most efficient way?  Seems to work pretty well?  
	  		// I'm trying to do this with few divs on the main page / just a skeleton
	  		// cleanup for current round.  
	  		$("#aliveCharactersHere").empty();
	  		$("#playerCharacterHere").empty();
	  		$("#opponentCharacterHere").empty();
	  		$("#defeatedCharactersHere").empty();
	  		var targetAliveDiv = $("#aliveCharactersHere");
	  		var targetPlayerDiv = $("#playerCharacterHere");
	  		var targetOpponentDiv = $("#opponentCharacterHere");
	  		var targetDefeatedDiv = $("#defeatedCharactersHere");
			// get each character and give them a div
	  		$.each(gameCharacters, function(name, character){

				var newDiv = document.createElement("div");
				var img = document.createElement("IMG");
				var statDiv = document.createElement("div");

	  			if (character.Status == "player"){
	  				console.log("This is the chosen player: " + character.FullName);
	  				targetPlayerDiv.append(newDiv);
	  				// TODO style for player
	  			}
	  			else if (character.Status == "opponent") {
	  				console.log("This is the chosen opponent: " + player.Opponent);
	  				targetOpponentDiv.append(newDiv);
	  				// TODO style for opponent
	  			}
	  			else if (character.Status == "alive") {
	  				console.log("This toon alive and ready in character pool: " + character.FullName);
	    			targetAliveDiv.append(newDiv);
	    			// TODO style for alive
	    		}
	    		else if (character.Status == "defeated") {
	    			console.log("This toon is defeated already: " + character.FullName);
	    			targetDefeatedDiv.append(newDiv);
	    			// TODO style for defeated
	    		}
	    		else {
	    			console.log("annnd we're broken again - something wrong with character divs");
	    		}
				//newDiv.innerHTML = character.FullName;
	    		//newDiv.setAttribute("id", character.ShortName);
	    		img.setAttribute("id", character.ShortName);
	    		img.src = character.Image;
	    		statDiv.className = "row";
	    		statDiv.innerHTML = "<br>" + character.FullName + "<br>HP: " + character.HP + " AP: " + character.AP + " Counter: " + character.CounterAP;
	    		newDiv.append(img)
	    		newDiv.append(statDiv);

	  		})
	  	}

	  	function initialSetup() {
			var gameCharacters = {
	  			Luke: {
	  				FullName:"Luke Skywalker",
	  				ShortName:"Luke",
	  				Status:"alive",
	  				HP:100,
	  				AP:20,
	  				APGrowth:20,
	  				CounterAP:5,
	  				Image:"assets/images/Luke.jpg"},
	  			ObiWan: {
	  				FullName:"Obi-Wan Kenobi",
	  				ShortName:"ObiWan",
	  				Status:"alive",
	  				HP:120,
	  				AP:12,
	  				APGrowth:12,
	  				CounterAP:10,
	  				Image:"assets/images/ObiWan.jpg"},
	  			DarthSidious: {
	  				FullName:"Darth Sidious",
	  				ShortName:"DarthSidious",
	  				Status:"alive",
	  				HP:150,
	  				AP:10,
	  				APGrowth:10,
	  				CounterAP:15,
					Image:"assets/images/DarthSidious.jpg"},
	  			DarthMaul: {
	  				FullName:"Darth Maul",
	  				ShortName:"DarthMaul",
	  				Status:"alive",
	  				HP:180,
	  				AP:10,
	  				APGrowth:10,
	  				CounterAP:25,
	  				Image:"assets/images/DarthMaul.jpg"}
	  		// 		,
	  		// 	Template: {
	  		// 		FullName:"Template for later",
	  		// 		ShortName:"Template",
	  		// 		Status:"alive",
	  		// 		HP:180,
	  		// 		AP:10,
	  		// 		APGrowth:10,
	  		// 		CounterAP:25,
			// 		Image:"assets/images/Template.jpg"}
  			}

  			targetDiv = $("#allCharactersHere");

	  		$.each(gameCharacters, function(name, character){

	  			console.log("name: " + name + " character: " + character);
				var newDiv = document.createElement("div");
				var img = document.createElement("IMG");

				if (character.Status == "alive") {
	  				console.log("This toon alive and ready in character pool: " + character.FullName);
	    			targetDiv.append(newDiv);
	    			// TODO style for alive
	    		}
	    		else {
	    			console.log("annnd we're broken again - something wrong with initial setup: >" + character.FullName + "< >" + character.Status + "<");
	    		}
	    		console.log("Creating and appending div and image for: " + character.FullName);
				// TODO overlay this
				//newDiv.innerHTML = character.FullName;
	    		img.setAttribute("id", character.ShortName);
	    		img.src = character.Image;
	    		newDiv.append(img)
	  		})

	  		return gameCharacters;
	  	}

	  	// TODO add a way to see HP / AP stats
	  	function characterStatusUpdate(thisCharacterDiv) {
	  		targetDiv = $(thisCharacterDiv);
	  		//targetDiv.empty();
	  		var newDiv = document.createElement("div");
	
			newDiv.innerHTML = character.HP;
	    	newDiv.setAttribute("id", character.ShortName);
	    	img.setAttribute("id", character.ShortName);
	    		img.src = character.Image;
	    		newDiv.append(img)
	  		// TODO update all of the divs associated with each player
	  		// HP
	  		// AP
	  		// Status
	  	}

	  	function isValidClick(thisId) {
	  		var thisClickValidityCheck = false;
	  		$.each(gameCharacters, function(name, character){
	  			if (character.ShortName == thisId && character.Status == "alive") {
	  				console.log("we have a valid click on a valid target");
	  				thisClickValidityCheck = true;
	  			}
	  		});
	  		return thisClickValidityCheck;
	  	}

	  	function setupGame() {

	  	}
	

	</script>
</body>
</html>